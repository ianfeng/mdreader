<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>本地 Markdown 查看器</title>

  <!-- Highlight.js 样式（浅色主题） -->
  <!--link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css"-->

  <style>

    html {
      font-size: 62.5%; /* 1rem = 10px */
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      line-height: 1.6;
      padding: 2rem;
      /*max-width: 800px;*/
      margin: 0 auto;
      background-color: #f8f9fa;
      color: #333;
      font-size: clamp(1.4rem, 2.5vw, 1.8rem);
    }
    .container {
        background: #f8f9fa;
        border-radius: 0.8rem;
        padding: 3rem;
        box-shadow: 0 0.2rem 1rem rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
      margin-bottom: 2rem;
    }

    #fileInput {
      display: block;
      margin: 2rem auto;
      padding: 0.8rem;
      font-size: 1.6rem;
    }

    /* 代码块样式 */
    pre code {
      font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
      background-color: #f8f8f8e0; /* 浅色背景 */
      padding: 1em;
      border-radius: 0.6rem;
      display: block;
      overflow-x: auto;
      line-height: 1.5;
    }

    /* 行号表格样式 */
    .hljs-ln {
      border-collapse: collapse;
      width: 100%;
    }
    .hljs-ln td {
      padding: 0;
      vertical-align: top;
    }
    .hljs-ln-numbers {
      text-align: right;
      color: #01a12c;
      padding-right: 1rem;
      user-select: none;
      border-right: 1rem solid #eee;
    }
    .hljs-ln-code {
      padding-left: 1rem;
    }
    /* fy定制 Highlight.js 样式（浅色主题）*/
    .hljs {
      color:#24292e;
      background:#eee
    }
    .hljs-doctag,
    .hljs-keyword,
    .hljs-meta .hljs-keyword,
    .hljs-template-tag,
    .hljs-template-variable,
    .hljs-type,
    .hljs-variable.language_ {
      color:#d73a49
    }
    .hljs-title,
    .hljs-title.class_,
    .hljs-title.class_.inherited__,
    .hljs-title.function_ {
      color:#6f42c1
    }
    .hljs-attr,
    .hljs-attribute,
    .hljs-literal,
    .hljs-meta,
    .hljs-number,
    .hljs-operator,
    .hljs-selector-attr,
    .hljs-selector-class,
    .hljs-selector-id,
    .hljs-variable {
      color:#005cc5
    }
    .hljs-meta .hljs-string,
    .hljs-regexp,
    .hljs-string {
      color:#032f62
    }
    .hljs-built_in,
    .hljs-symbol {
      color:#e36209
    }
    .hljs-code,
    .hljs-comment,
    .hljs-formula {
      color:#6a737d
    }
    .hljs-name,
    .hljs-quote,
    .hljs-selector-pseudo,
    .hljs-selector-tag {
      color:#22863a
    }
    .hljs-subst {
      color:#24292e
    }
    .hljs-section {
      color:#005cc5;
      font-weight:700
    }
    .hljs-bullet {
      color:#735c0f
    }
    .hljs-emphasis {
      color:#24292e;
      font-style:italic
    }
    .hljs-strong {
      color:#24292e;
      font-weight:700
    }
    .hljs-addition {
      color:#22863a;
      background-color:#f0fff4
    }
    .hljs-deletion {
      color:#b31d28;
      background-color:#ffeef0
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Markdown 查看器（带语法高亮）</h1>
    <input type="file" id="fileInput" accept=".md,.markdown" />
  
    <div id="content">
      <p>请选择一个 .md 文件进行预览。</p>
    </div>
  </div>


  <!-- 引入 marked 和 highlight.js -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <!-- 只加载常用语言（可按需增减） -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/bash.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/json.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/html.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/css.min.js"></script>
  <!-- 如需全部语言，可替换为 all.min.js（但注意 URL 不能有空格！） -->

  <script>
    // 配置 marked 使用 highlight.js
    marked.setOptions({
      highlight: function(code, lang) {
        const language = hljs.getLanguage(lang) ? lang : 'plaintext';
        return hljs.highlight(code, { language }).value;
      },
      langPrefix: 'hljs language-'
    });

    // 行号生成函数
    function addLineNumbers(block) {
      if (block.hasAttribute('data-ln-processed')) return;
      block.setAttribute('data-ln-processed', 'true');

      const lines = block.innerHTML.split(/\n/).filter(line => line.trim() !== '');
      let tableHTML = '<table class="hljs-ln"><tbody>';
      lines.forEach((line, i) => {
        tableHTML += `
          <tr>
            <td class="hljs-ln-numbers"><div class="hljs-ln-line">${i + 1}</div></td>
            <td class="hljs-ln-code"><div class="hljs-ln-line">${line}</div></td>
          </tr>`;
      });
      tableHTML += '</tbody></table>';
      block.innerHTML = tableHTML;
    }

    // 文件选择事件
    document.getElementById('fileInput').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(event) {
        const mdText = event.target.result;
        const html = marked.parse(mdText);
        document.getElementById('content').innerHTML = html;

        // 对所有代码块进行高亮 + 行号
        document.querySelectorAll('pre code').forEach((block) => {
          // 先高亮
          if (!block.classList.contains('hljs')) {
            hljs.highlightElement(block);
          }
          // 再加行号
          addLineNumbers(block);
        });
      };
      reader.readAsText(file, 'UTF-8');
    });
  </script>
</body>
</html>
